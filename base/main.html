<div id="side" style="display:none;"></div>
<div id="main" style="display:none;"></div>
<div id="debug" style="display:none;"></div>

<div id="tool" style="display:none;">
  <ul>
    <li>iphone</li>
    <ul>
      <li id="landscape">landscape</li>
      <li id="portscape">portscape</li>
    </ul>
    <li id="web">web</li>
    <ul>
      <li>debug</li>
      <li>...</li>
    </ul>
  </ul>
</div>

<style type="text/css">
* {
  margin:0; padding:0;
}

#side {
  position:absolute;
  top:0px; left:0px;
  width:320px; height:480px;
  background:#222;
}
#main {
  position:absolute;
  top:0px; left:320px;
  width:480px; height:320px;
  background:#333;
}
#debug {
  position:absolute;
  top:320px; left:320px;
  width:480px; height:160px;
  overflow:auto;
  background:#444;
  font: normal normal 88% "Courier";
}
#tool {
  position:absolute;
  top:0px; right:0px;
}
</style>

<script language="javascript">

// **** mock console if not avaliable
if (!console) console = (function(){
  $("#debug").show();
  function log(lvl, str){
    $("#debug").append("["+lvl+"]"+str+"<br>");
    // auto scroll to bottom
    var t = $("#debug").get(0).scrollHeight;
    var v = $("#debug").get(0).offsetHeight;
    $("#debug").get(0).scrollTop = t - v;
  }
  return {
    debug: function(s){ log("DEBUG", s); },
    info:  function(s){ log("INFO ", s); },
    error: function(s){ log("ERROR", s); },
    warn:  function(s){ log("WARN ", s); },
    fatal: function(s){ log("FATAL", s); }
  };
})();

// **** the scene nameing
if (!this.getScene) getScene = function(){
  var url = window.location.hash.split('#')[1];
  return (url) ? url : undefined;
};

// **** the boot loader :: load everything
$(function(){

  // current device orient
  // iphone : landscape/portscape
  // web : undefined
  var currentDirect = "landscape"; // undefined;

  // iphone ui // for iphone
  function iphone_ui(){
    var x = undefined;
    if (window.outerWidth == 480) x = "landscape";
    else if (window.outerWidth == 320) x = "portscape";
    else x = undefined;
    if (x != currentDirect) switch_ui(x);
    // window.setTimeout(function(){ iphone_ui(); }, 400); // iphone detect
  }
  function switch_ui(direct){
    switch(direct){
      case "landscape" :
        $("#side").hide();
        $("#main").css({top:'0px', left:'0px'}).show();
        break;
      case "portscape" :
        $("#side").css({top:'0px', left:'0px'}).show();
        $("#main").hide();
        break;
      default :
        $("#main").css({top:'0px', left:'320px'}).show();
        $("#side").css({top:'0px', left:'0px'}).show();
        break;
    }
    currentDirect = direct;
  }
  iphone_ui();

  $("#tool #landscape").click(function(){ switch_ui("landscape"); });
  $("#tool #portscape").click(function(){ switch_ui("portscape"); });
  $("#tool #web").click(function(){ switch_ui(); });

  ui.load("#side", "/side");
  ui.load("#main", getScene() ? getScene() : "/home" );

});

</script>
